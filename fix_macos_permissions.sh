#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ macOS
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./fix_macos_permissions.sh

APP_PATH="XeusGUI.app"

if [ ! -d "$APP_PATH" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: $APP_PATH –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø–∞–ø–∫–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º."
    exit 1
fi

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è $APP_PATH..."

# –£–¥–∞–ª—è–µ–º –∫–∞—Ä–∞–Ω—Ç–∏–Ω (quarantine) –∞—Ç—Ä–∏–±—É—Ç
echo "1. –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä–∞–Ω—Ç–∏–Ω–∞..."
xattr -dr com.apple.quarantine "$APP_PATH" 2>/dev/null || echo "   –ö–∞—Ä–∞–Ω—Ç–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω"

# –£–¥–∞–ª—è–µ–º –¥—Ä—É–≥–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫
echo "2. –û—á–∏—Å—Ç–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤..."
xattr -cr "$APP_PATH" 2>/dev/null || echo "   –ê—Ç—Ä–∏–±—É—Ç—ã –æ—á–∏—â–µ–Ω—ã"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
echo "3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ..."
chmod +x "$APP_PATH/Contents/MacOS/XeusGUI" 2>/dev/null || echo "   –ü—Ä–∞–≤–∞ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ adhoc (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å)
echo "4. –ü–æ–¥–ø–∏—Å—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
codesign --force --deep --sign - "$APP_PATH" 2>/dev/null || echo "   –ü–æ–¥–ø–∏—Å—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è"

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:"
echo "   - –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ $APP_PATH"
echo "   - –ò–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª: open $APP_PATH"
echo ""
echo "–ï—Å–ª–∏ macOS –≤—Å–µ –µ—â–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫:"
echo "1. –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ‚Üí '–û—Ç–∫—Ä—ã—Ç—å'"
echo "2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å"
echo "3. –ù–∞–∂–º–∏—Ç–µ '–û—Ç–∫—Ä—ã—Ç—å –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ' —Ä—è–¥–æ–º —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º"

